#include <stdio.h>
#include <stdlib.h>
#include "validaciones.h"
#include "otros.h"
#include "menus.h"

#include "avion.h"
#include "aerolinea.h"
#define TAM_HCODE_A 5
#define TAM_HCODE_TD 4
#define TAM_AVION 1000
#define TAM_VUELO 2000



typedef struct{
	int dia;
	int mes;
	int anio;
}eFecha;

typedef struct{
	int id;
	int idAvion;
	int idDestino;
	eFecha fecha;
}eVuelo;








void listarVuelo(eVuelo vuelos, eDestino destinos[],int tamTD);
int listarVuelos(eVuelo vuelos[], eDestino destinos[],int tamVuelo,int tamTD,int lenVuelos );





int altaVuelo(eVuelo vuelos[], eAvion aviones[], eDestino destinos[],eAerolinea aerolineas[], eTipo tipos[],  int tamVuelos,int tamAviones, int tamTD, int tamA, int* idVuelo, int* indexVuelo);


int main(void) {
	setbuf(stdout,NULL);
	eAerolinea aerolineas[TAM_HCODE_A]={
			{1000,"Lan"},
			{1001,"Iberia"},
			{1002,"Norwegian"},
			{1003,"American,"},
			{1004,"Austral"}
	};
	eTipo tipos[TAM_HCODE_TD]={
			{5000,"Jet"},
			{5001,"Helice"},
			{5002,"Planeador"},
			{5003,"Carga"},
	};
	eDestino destinos[TAM_HCODE_TD]={
			{20000,"Calafate",100000},
			{20001,"Miami",100000},
			{20002,"Madrid",100000},
			{20003,"Amsterdam",100000},
	};

	eAvion aviones[TAM_AVION];
	int idIncrem=4000;
	inicializarArray(aviones, TAM_AVION);


	eVuelo vuelos[TAM_VUELO];
	int idInVuelo=40000;
	int indexVuelo=0;

	char salir='n';
	do{
			switch(menu()){
			case 1:

				if(altaAvion(aviones, aerolineas, tipos, TAM_AVION, TAM_HCODE_TD, TAM_HCODE_A, &idIncrem)==-1){
					printf("Error al validar punteros o tam menor a cero.\n");
				}else{
					printf("Se cargaron los datos con exito.\n");
				}
				break;
			case 2:
				if(existeRegistro(aviones, TAM_AVION)==0){
					if(modificarAvion(aviones, aerolineas, tipos, TAM_AVION, TAM_HCODE_A, TAM_HCODE_TD)==-1){
						printf("Error al validar punteros o tam menor a cero.\n");
					}else{
						printf("Se modifico con exito.\n");
					}
				}else{
					printf("Primero debe registrar un avion.\n");
				}
				break;
			case 3:
				if(existeRegistro(aviones, TAM_AVION)==0){
					if(bajaAvion(aviones, aerolineas, tipos, TAM_AVION, TAM_HCODE_A, TAM_HCODE_TD)==-1){
						printf("Error al validar punteros o tam menor a cero.\n");
					}
				}else{
					printf("Primero debe registrar un avion.\n");
				}
				break;
			case 4:
				if(listarAviones(aviones, aerolineas, tipos,TAM_AVION, TAM_HCODE_A, TAM_HCODE_TD)==-1){
					printf("HUbo un error al validar punteros.\n");
				}
				break;
			case 5:
				if(listarAerolineas(aerolineas, TAM_HCODE_A)==-1){
					printf("HUbo un error al validar punteros.\n");
				}
				break;
			case 6:
				if(listarTipos(tipos, TAM_HCODE_TD)==-1){
					printf("HUbo un error al validar punteros.\n");
				}
				break;
			case 7:
				if(listarDestinos(destinos, TAM_HCODE_TD)==-1){
					printf("HUbo un error al validar punteros.\n");
				}
				break;
			case 8:
				if(existeRegistro(aviones, TAM_AVION)==0){
					if(altaVuelo(vuelos, aviones,destinos, aerolineas, tipos, TAM_VUELO,TAM_AVION, TAM_HCODE_TD,TAM_HCODE_A,&idInVuelo, &indexVuelo)==-1){
						printf("Error al validar punteros o tam menor a cero.\n");
					}
				}else{
					printf("Primero debe registrar un avion.\n");
				}
				break;
			case 9:
				if(listarVuelos(vuelos, destinos,TAM_VUELO, TAM_HCODE_TD, indexVuelo)==-1){
					printf("HUbo un error al validar punteros.\n");
				}
				break;
			case 10:
				if(!cerrar(&salir)){
					printf("Hubo un problema con la validacion.\n");
				}
				break;
			}
			system("pause");
			system("cls");
		}while(salir!='s');
	return EXIT_SUCCESS;

}




/* ------------------------LISTADOS----------------------------------*/







void listarVuelo(eVuelo vuelos, eDestino destinos[],int tamTD){
	printf("%4d %10d %15s %d/%d/%d\n", vuelos.id, vuelos.idAvion, destinos[buscarIndexPorIdDestino(destinos, tamTD, vuelos.idDestino)].descripcion,vuelos.fecha.dia ,vuelos.fecha.mes,vuelos.fecha.anio);
}
int listarVuelos(eVuelo vuelos[], eDestino destinos[],int tamVuelo,int tamTD,int lenVuelos ){
	int todoOk=-1;
	if(vuelos!=NULL && destinos!=NULL && tamVuelo>0 && tamTD>0){
		system("cls");
		printf(".......................\n");
		printf("  ID      COD-AVION     DESTINO  FECHA\n");
		printf(".......................\n");
		for(int i=0; i<lenVuelos;i++){
				listarVuelo(vuelos[i], destinos, tamTD);
		}
		printf(".......................\n");
		todoOk=0;
	}
	return todoOk;
}

/* ------------------------Alta----------------------------------*/


/* ------------------------buscadores----------------------------------*/


int buscarIndexPorIdAvion(eAvion aviones[], int tamAvion, int id){

	int todoOk=-1;
	if(aviones!=NULL && tamAvion>0){
		for(int i=0; i<tamAvion; i++){
			if(aviones[i].id== id && aviones[i].isEmpty==0){
				todoOk=i;
				break;
			}
		}
	}
	return todoOk;
}



/* ------------------------MODIFICAR  y BAJA----------------------------------*/

/* ------------------------VUELO----------------------------------*/
int altaVuelo(eVuelo vuelos[], eAvion aviones[], eDestino destinos[],eAerolinea aerolineas[], eTipo tipos[],  int tamVuelos,int tamAviones, int tamTD, int tamA, int* idVuelo, int* indexVuelo){
	int todoOk=-1;
	int idAvion;
	int idDestino;
	int dia;
	int mes;
	int anio;

	int index;
	int idAux;
	if(vuelos!=NULL && aviones!=NULL && destinos!=NULL && idVuelo!=NULL && indexVuelo!=NULL && tamVuelos>0 && tamAviones>0 && tamTD>0){
		do{
			listarAviones(aviones,aerolineas, tipos, tamAviones,tamA, tamTD);
			cargarValidarEntero("Ingrese el id Avion",&idAux);
			index=buscarIndexPorIdAvion(aviones, tamAviones, idAux);
			if(index==-1){
				printf("No se encontro el id seleccionado.\n");
				system("pause");
			}else{
				idAvion=aviones[index].id;
			}
		}while(index==-1);


		do{
			listarDestinos(destinos, tamTD);
			cargarValidarEntero("Ingrese el id del destino",&idAux);
			index=buscarIndexPorIdDestino(destinos, tamTD, idAux);
			if(index==-1){
				printf("No se encontro el id seleccionado.\n");
				system("pause");
			}else{
				idDestino=destinos[index].id;
			}
		}while(index==-1);
		cargarValidarFecha(&dia,&mes,&anio);

		vuelos[*indexVuelo].id=*idVuelo;
		vuelos[*indexVuelo].idAvion=idAvion;
		vuelos[*indexVuelo].idDestino=idDestino;
		vuelos[*indexVuelo].fecha.dia=dia;
		vuelos[*indexVuelo].fecha.mes=mes;
		vuelos[*indexVuelo].fecha.anio=anio;
		(*idVuelo)++;
		(*indexVuelo)++;
		printf("Se guardaron los datos con exito.\n");
		system("pause");

		todoOk=0;
	}
	return todoOk;
}
